<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
  <meta>
    <author>Rainer Borene</author>
    <description>Pesquisa na lista de produtos vendidos na Submarino</description>
    <documentationURL></documentationURL>
    <sampleQuery>select * from {table} where query="ipod" and offset="20" and limit="20"</sampleQuery>
  </meta>
  <bindings>
    <select produces="XML">
      <urls>
        <url>www.carrosaojose.com.br/veiculos</url>
      </urls>
      <inputs>
        <key id="revenda_id" as="revenda" type="xs:string" paramType="query" required="true" />
      </inputs>
      <execute><![CDATA[

        // var results = [];
        var resultado = {};
        resultado.online = true;

        var data = request.accept('text/html').get().response;
        var xpath_carros = y.xpath(data, "//div[contains(@class, 'produto')]");
        var xpath_titulo = '';

        resultado.quantidadeDeCarros = xpath_carros.length;

        // for(var i)
        // for each (var carro in xpath_carros) {
        // 	xpath_titulo = y.xpath(carro, "//a[contains(@class, 'titulo')/text()]");

        // }

        //var total_entries = y.xpath(data, "//div[@class='bottomPageList']/ul[@class='results']/li/p/text()");

        // for each (var carro in carros) {
        //   results.push({
        //     titulo: y.xpath(item, "//a[contains(@class, 'titulo')]/text()")
        //   });
        // }

        // if (results.length) {
        //   var output = <products></products>;

        //   for (item in results) {
        //     output.node += <entry>
        //       <title>{results[item].titulo}</title>
        //     </entry>;
        //   }

        //   //output.@items = total_entries.match(/\d+$/)[0];
        // }

        response.object = y.jsonToXml(resultado);

        ]]>
      </execute>
    </select>
  </bindings>
</table>
