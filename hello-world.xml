<?xml version="1.0" encoding="UTF-8"?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
    <meta>
        <author>Jota Teles (http://www.jotateles.com.br) </author>
        <description>Essa tabela retorna dados gerais sobre uma revenda cadastrada no site www.carrosaojose.com.br</description>        
        <documentationURL> http://github.com/teles/yql-tables</documentationURL>
        <sampleQuery>SELECT * FROM {table} WHERE id='3639';</sampleQuery>        
    </meta>
      <bindings>
        <select produces="XML">
        <inputs>
          <key id="id" type="xs:string" paramType="variable" required="true"/>
        </inputs>
        <execute><![CDATA[
          // var data = request.accept('text/html').get().response;
          var url = "http://www.carrobauru.com.br/veiculos/2289233-chevrolet-astra-sedan-2.0-4p-flex-elegance.html?e=1"
          var data = y.rest(url).accept('text/html').get().response;    

          var carroXpath = {
              nome: "//div[contains(@class, 'nomeVeic')]/div[contains(@class, 'titulo')]",
              ano: "//div[contains(@class, 'nomeVeic')]/div[contains(@class, 'ano')]",
              valor: "//div[contains(@class, 'valorVeic')]",
              combustivelCorQuilometragem: "//div[contains(@class, 'topoDetDesc')]"
          };

          // Definição dos elementos raiz com dados do carro
          var nome = y.xpath(data, carroXpath.nome);
          var ano = y.xpath(data, carroXpath.ano);
          var valor = y.xpath(data, carroXpath.valor);
          var combustivelCorQuilometragem = y.xpath(data, carroXpath.combustivelCorQuilometragem);

          // Montando objeto revenda com dados raspados da url
          var carro = {}
          carro.nome = nome.toString();
          carro.ano = ano.toString();
          carro.valor = valor.toString();
          carro.combustivelCorQuilometragem = combustivelCorQuilometragem.toString();

          // Montando xml com os dados do objeto revenda
          carroXml = <carro></carro>;
          carroXml.appendChild(<nome>{carro.nome}</nome>);
          carroXml.appendChild(<ano>{carro.ano}</ano>);
          carroXml.appendChild(<valor>{carro.valor}</valor>);
          carroXml.appendChild(<infos>{carro.combustivelCorQuilometragem}</infos>);
          
          response.object = carroXml;

        ]]>
        </execute>
      </select>
      </bindings>
</table>